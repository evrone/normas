{"version":3,"file":"normasMutations.js","sources":["../../src/js/mixins/mutations.js"],"sourcesContent":["// EXPERIMENTAL\n\nlet initialMutations = true;\n\nexport default Base => (class extends Base {\n  constructor(options) {\n    super(options);\n    if (!this.enablings) this.enablings = {};\n    this.enablings.mutations = this.constructor.readOption(options.enablings, 'mutations', true);\n    this.log('info', 'construct',\n      ...this.constructor.logColor(`ðŸ¤– \"${this.instanceName}\" MutationObserver %REPLACE%.`,\n        this.enablings.turbolinks ? 'enabled' : 'disabled',\n        this.enablings.turbolinks ? 'green' : 'blue'));\n    if (this.enablings.mutations) {\n      if (MutationObserver) {\n        this.observeMutations();\n        this.log('construct', `ðŸ¤– \"${this.instanceName}\" mutation observer activated. (EXPERIMENTAL feature)`);\n      } else {\n        this.log('warn', 'construct', `ðŸ¤– \"${this.instanceName}\" mutation observer NOT SUPPORTED!`);\n      }\n    }\n  }\n\n  observeMutations() {\n    // https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver\n    this.mutationObserver = new MutationObserver(mutations => mutations.forEach(this.checkMutations));\n    this.mutationObserver.observe(this.$el[0], { childList: true, subtree: true });\n  }\n\n  checkMutations = (mutation) => {\n    if (mutation.type !== 'childList') {\n      return;\n    }\n\n    const removedNodes = this.constructor.filterMutationNodes(mutation.removedNodes);\n    const addedNodes = this.constructor.filterMutationNodes(mutation.addedNodes, true);\n\n    if (removedNodes.length > 0) {\n      this.sayAboutContentLeave($(removedNodes));\n    }\n    if (addedNodes.length > 0) {\n      this.sayAboutContentEnter($(addedNodes));\n    }\n  };\n\n  pageEnter() {\n    if (initialMutations) {\n      initialMutations = false;\n    }\n    super.pageEnter();\n  }\n\n  static filterMutationNodes(nodes, checkParentNode = false) {\n    return Array.prototype.filter.call(nodes, node => {\n      if (initialMutations) {\n        node.normasInitialMutationReady = true;\n        if (node.parentElement && node.parentElement.normasInitialMutationReady) {\n          return false;\n        }\n      }\n      return node.nodeType === 1 &&\n        !node.isPreview &&\n        !['TITLE', 'META'].includes(node.tagName) &&\n        node.className !== 'turbolinks-progress-bar' &&\n        !(checkParentNode && !node.parentElement) &&\n        !(node.parentElement && node.parentElement.tagName === 'HEAD');\n    });\n  }\n});\n"],"names":["initialMutations","options","mutation","type","removedNodes","constructor","filterMutationNodes","addedNodes","length","sayAboutContentLeave","$","sayAboutContentEnter","enablings","mutations","readOption","log","logColor","instanceName","turbolinks","MutationObserver","observeMutations","mutationObserver","forEach","checkMutations","observe","$el","childList","subtree","nodes","checkParentNode","Array","prototype","filter","call","normasInitialMutationReady","node","parentElement","nodeType","isPreview","includes","tagName","className","Base"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AAEA,IAAIA,mBAAmB,IAAvB;;AAEA,iBAAe;;;;qBACDC,OAAZ,EAAqB;;;mHACbA,OADa;;;;;eAwBJ,eAACC,QAAD,EAAc;cACzBA,SAASC,IAAT,KAAkB,WAAtB,EAAmC;;;;cAI7BC,eAAe,MAAKC,WAAL,CAAiBC,mBAAjB,CAAqCJ,SAASE,YAA9C,CAArB;cACMG,aAAa,MAAKF,WAAL,CAAiBC,mBAAjB,CAAqCJ,SAASK,UAA9C,EAA0D,IAA1D,CAAnB;;cAEIH,aAAaI,MAAb,GAAsB,CAA1B,EAA6B;kBACtBC,oBAAL,CAA0BC,EAAEN,YAAF,CAA1B;;cAEEG,WAAWC,MAAX,GAAoB,CAAxB,EAA2B;kBACpBG,oBAAL,CAA0BD,EAAEH,UAAF,CAA1B;;;;;UAlCE,CAAC,MAAKK,SAAV,EAAqB,MAAKA,SAAL,GAAiB,EAAjB;YAChBA,SAAL,CAAeC,SAAf,GAA2B,MAAKR,WAAL,CAAiBS,UAAjB,CAA4Bb,QAAQW,SAApC,EAA+C,WAA/C,EAA4D,IAA5D,CAA3B;YACKG,GAAL,eAAS,MAAT,EAAiB,WAAjB,2BACK,MAAKV,WAAL,CAAiBW,QAAjB,oBAAiC,MAAKC,YAAtC,oCACD,MAAKL,SAAL,CAAeM,UAAf,GAA4B,SAA5B,GAAwC,UADvC,EAED,MAAKN,SAAL,CAAeM,UAAf,GAA4B,OAA5B,GAAsC,MAFrC,CADL;UAII,MAAKN,SAAL,CAAeC,SAAnB,EAA8B;YACxBM,gBAAJ,EAAsB;gBACfC,gBAAL;gBACKL,GAAL,CAAS,WAAT,qBAA6B,MAAKE,YAAlC;SAFF,MAGO;gBACAF,GAAL,CAAS,MAAT,EAAiB,WAAjB,qBAAqC,MAAKE,YAA1C;;;;;;;;yCAKa;;;;aAEZI,gBAAL,GAAwB,IAAIF,gBAAJ,CAAqB;iBAAaN,UAAUS,OAAV,CAAkB,OAAKC,cAAvB,CAAb;SAArB,CAAxB;aACKF,gBAAL,CAAsBG,OAAtB,CAA8B,KAAKC,GAAL,CAAS,CAAT,CAA9B,EAA2C,EAAEC,WAAW,IAAb,EAAmBC,SAAS,IAA5B,EAA3C;;;;kCAmBU;YACN3B,gBAAJ,EAAsB;6BACD,KAAnB;;;;;;0CAKuB4B,KAhDd,EAgD8C;YAAzBC,eAAyB,uEAAP,KAAO;;eAClDC,MAAMC,SAAN,CAAgBC,MAAhB,CAAuBC,IAAvB,CAA4BL,KAA5B,EAAmC,gBAAQ;cAC5C5B,gBAAJ,EAAsB;iBACfkC,0BAAL,GAAkC,IAAlC;gBACIC,KAAKC,aAAL,IAAsBD,KAAKC,aAAL,CAAmBF,0BAA7C,EAAyE;qBAChE,KAAP;;;iBAGGC,KAAKE,QAAL,KAAkB,CAAlB,IACL,CAACF,KAAKG,SADD,IAEL,CAAC,CAAC,OAAD,EAAU,MAAV,EAAkBC,QAAlB,CAA2BJ,KAAKK,OAAhC,CAFI,IAGLL,KAAKM,SAAL,KAAmB,yBAHd,IAIL,EAAEZ,mBAAmB,CAACM,KAAKC,aAA3B,CAJK,IAKL,EAAED,KAAKC,aAAL,IAAsBD,KAAKC,aAAL,CAAmBI,OAAnB,KAA+B,MAAvD,CALF;SAPK,CAAP;;;;IAjDkCE,IAAvB;CAAf;;;;"}
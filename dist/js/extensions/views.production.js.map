{"version":3,"file":"views.production.js","sources":["../../../src/js/mixins/view.js","../../../src/js/mixins/views.js"],"sourcesContent":["export default Base => (class extends Base {\n  // Override it with your own initialization logic (like componentDidUnmount in react).\n  initialize(options) {\n  }\n\n  // Override it with your own unmount logic (like componentWillUnmount in react).\n  terminate() {\n  }\n\n  // protected\n\n  constructor(options) {\n    Object.assign(options, options.$el.data());\n    super(options);\n    this.reflectOptions(options);\n    this.initializeEvents(options);\n    this.initialize(options);\n    if (NORMAS_DEBUG && this.logging.constructGrouping) {\n      this.log('groupEnd', 'construct');\n    }\n  }\n\n  destructor() {\n    if (NORMAS_DEBUG) {\n      const [destructText, ...destructStyles] = this.constructor.logColor('destructing', 'red');\n      this.log(this.constructor.groupingMethod(this.logging.constructGrouping), 'construct',\n        ...this.constructor.logBold(`${this.logging.constructPrefix} \"%REPLACE%\" ${destructText}`, this.instanceName),\n        ...destructStyles,\n        this);\n    }\n    this.terminate();\n    if (this.listenedEvents) {\n      this.forgetEvents(this.listenedEvents);\n      this.listenedEvents = null;\n    }\n    if (NORMAS_DEBUG && this.logging.constructGrouping) {\n      this.log('groupEnd', 'construct');\n    }\n  }\n\n  reflectOptions(options) {\n    if (!this.constructor.reflectOptions) {\n      return;\n    }\n    Object.keys(options).forEach(attr => {\n      if (this.constructor.reflectOptions.includes(attr)) {\n        this[attr] = options[attr];\n      }\n    });\n  }\n\n  initializeEvents(_options) {\n    const { events } = this.constructor;\n    if (events) {\n      if (!this.linkedEvents) {\n        this.linkedEvents = this.linkEvents(this.helpers.isFunction(events) ? events() : events);\n      }\n      this.listenedEvents = this.listenEvents(this.linkedEvents);\n    }\n  }\n\n  linkEvents(events) {\n    return this.helpers.mapValues(events, handle => this.helpers.isString(handle) ?\n      this[handle].bind(this)\n      :\n      (typeof this.helpers.isPlainObject(handle) ? this.linkEvents(handle) : handle)\n    );\n  }\n});\n","/**\n * Views system for Normas\n *\n * @see {@link https://github.com/evrone/normas#-views|Docs}\n * @see {@link https://github.com/evrone/normas/blob/master/src/js/mixins/views.js|Source}\n * @license MIT\n * @copyright Dmitry Karpunin <koderfunk@gmail.com>, 2017-2018\n */\n\n// TODO: may be rename Views, views, View, view\nimport normasView from './view';\n\nexport default Base => normasViews(Base, normasView(Base.NormasCore));\n\n// require content mixin\n// require events mixin\nconst normasViews = (Base, View) => (class extends Base {\n  static View = View;\n  View = View;\n  viewClasses = {};\n  viewInstances = [];\n\n  constructor(options) {\n    super(options);\n    this.viewOptions = {\n      debugMode: this.debugMode,\n      ...options.viewOptions,\n    };\n    if (NORMAS_DEBUG) {\n      this.viewOptions.logging = {\n        ...this.logging,\n        constructGrouping: 'groupCollapsed',\n        constructPrefix: '🏭', // private\n        eventsDebounced: false,\n        ...(options.viewOptions && options.viewOptions.logging),\n      };\n      this.log('info', 'construct', `🏭 \"${this.instanceName}\" views mixin activated.`);\n    }\n  }\n\n  registerView(viewClass, options = {}) {\n    if (this.viewClasses[viewClass.selector]) {\n      if (NORMAS_DEBUG) {\n        this.error(`🏭 View class for selector \\`${viewClass.selector}\\` already registered`,\n          this.viewClasses[viewClass.selector]);\n      }\n      return;\n    }\n    this.viewClasses[viewClass.selector] = viewClass;\n    this.listenToElement(\n      viewClass.selector,\n      $el => this.bindView($el, viewClass, options),\n      $el => this.unbindView($el, viewClass),\n      {\n        delay: viewClass.delay,\n        silent: true,\n      },\n    );\n  }\n\n  bindView($el, viewClass, options) {\n    if (!this.canBind($el, viewClass)) {\n      return null;\n    }\n    if (viewClass.instanceIndex) {\n      viewClass.instanceIndex += 1;\n    } else {\n      viewClass.instanceIndex = 1;\n    }\n    const view = new viewClass({\n      ...this.helpers.deepMerge(this.viewOptions, options),\n      instanceName: `${viewClass.selector}_${viewClass.instanceIndex}`,\n      $el,\n    });\n    this.viewInstances.push(view);\n    return view;\n  }\n\n  canBind($element, viewClass) {\n    const view = this.getViewsOnElement($element, viewClass)[0];\n    if (view) {\n      if (NORMAS_DEBUG) {\n        this.log('warn', '🏭 Element already has bound view', $element, viewClass, view);\n      }\n      return false;\n    }\n    return true;\n  }\n\n  unbindView($element, viewClass) {\n    const view = this.getViewsOnElement($element, viewClass)[0];\n    if (view) {\n      view.destructor();\n      this.viewInstances = this.helpers.without(this.viewInstances, view);\n    }\n  }\n\n  getViewsOnElement($element, viewClass = null) {\n    const el = $element instanceof $ ? $element[0] : $element;\n    const filterOptions = { el };\n    if (viewClass) {\n      filterOptions.constructor = viewClass;\n    }\n    return this.helpers.filter(this.viewInstances, filterOptions);\n  }\n\n  getViewsInContainer($container, checkRoot = true) {\n    return this.helpers.filter(this.viewInstances, view =>\n      view.$el.closest($container).length > 0 && (checkRoot || view.el !== $container[0])\n    );\n  }\n\n  getAllViews(viewClass) {\n    return this.helpers.filter(this.viewInstances, { constructor: viewClass });\n  }\n\n  getFirstView(viewClass) {\n    return this.helpers.find(this.viewInstances, { constructor: viewClass });\n  }\n\n  getFirstChildView(viewClass) {\n    return this.helpers.find(this.viewInstances, view => view instanceof viewClass);\n  }\n});\n"],"names":["options","assign","$el","data","reflectOptions","initializeEvents","initialize","Base","terminate","this","listenedEvents","forgetEvents","constructor","keys","forEach","_this2","includes","attr","_options","events","linkedEvents","linkEvents","helpers","isFunction","listenEvents","mapValues","_this3","isString","handle","bind","babelHelpers.typeof","isPlainObject","normasViews","View","viewOptions","_this","debugMode","viewClass","viewClasses","selector","listenToElement","bindView","unbindView","delay","canBind","instanceIndex","view","deepMerge","viewInstances","push","$element","getViewsOnElement","destructor","without","filterOptions","el","$","filter","$container","checkRoot","closest","length","find","normasView","NormasCore"],"mappings":"iuCAWcA,oBACHC,OAAOD,EAASA,EAAQE,IAAIC,uEAC7BH,aACDI,eAAeJ,KACfK,iBAAiBL,KACjBM,WAAWN,gBAhBkBO,yCAEzBP,0FA4BJQ,YACDC,KAAKC,sBACFC,aAAaF,KAAKC,qBAClBA,eAAiB,6CAOXV,cACRS,KAAKG,YAAYR,uBAGfS,KAAKb,GAASc,QAAQ,YACvBC,EAAKH,YAAYR,eAAeY,SAASC,OACtCA,GAAQjB,EAAQiB,+CAKVC,OACPC,EAAWV,KAAKG,YAAhBO,OACJA,IACGV,KAAKW,oBACHA,aAAeX,KAAKY,WAAWZ,KAAKa,QAAQC,WAAWJ,GAAUA,IAAWA,SAE9ET,eAAiBD,KAAKe,aAAaf,KAAKW,kDAItCD,qBACFV,KAAKa,QAAQG,UAAUN,EAAQ,mBAAUO,EAAKJ,QAAQK,SAASC,GACpEF,EAAKE,GAAQC,QAEZC,EAAOJ,EAAKJ,QAAQS,cAAcH,IAAUF,EAAKL,WAAWO,GAAUA,cCjDvEI,EAAc,SAACzB,EAAM0B,6CAMbjC,4EACJA,2EALDiC,gKAMAC,yBACQC,EAAKC,WACbpC,EAAQkC,0BAVkC3B,2CAwBpC8B,cAAWrC,4DAClBS,KAAK6B,YAAYD,EAAUE,iBAO1BD,YAAYD,EAAUE,UAAYF,OAClCG,gBACHH,EAAUE,SACV,mBAAOxB,EAAK0B,SAASvC,EAAKmC,EAAWrC,IACrC,mBAAOe,EAAK2B,WAAWxC,EAAKmC,WAEnBA,EAAUM,cACT,sCAKLzC,EAAKmC,EAAWrC,OAClBS,KAAKmC,QAAQ1C,EAAKmC,UACd,KAELA,EAAUQ,gBACFA,eAAiB,IAEjBA,cAAgB,MAEtBC,EAAO,IAAIT,OACZ5B,KAAKa,QAAQyB,UAAUtC,KAAKyB,YAAalC,iBAC3BqC,EAAUE,aAAYF,EAAUQ,mCAG9CG,cAAcC,KAAKH,GACjBA,kCAGDI,EAAUb,OACVS,EAAOrC,KAAK0C,kBAAkBD,EAAUb,GAAW,UACrDS,qCASKI,EAAUb,OACbS,EAAOrC,KAAK0C,kBAAkBD,EAAUb,GAAW,GACrDS,MACGM,kBACAJ,cAAgBvC,KAAKa,QAAQ+B,QAAQ5C,KAAKuC,cAAeF,8CAIhDI,OAAUb,yDAAY,KAEhCiB,GAAkBC,GADbL,aAAoBM,EAAIN,EAAS,GAAKA,UAE7Cb,MACYzB,YAAcyB,GAEvB5B,KAAKa,QAAQmC,OAAOhD,KAAKuC,cAAeM,+CAG7BI,OAAYC,oEACvBlD,KAAKa,QAAQmC,OAAOhD,KAAKuC,cAAe,mBAC7CF,EAAK5C,IAAI0D,QAAQF,GAAYG,OAAS,IAAMF,GAAab,EAAKS,KAAOG,EAAW,0CAIxErB,UACH5B,KAAKa,QAAQmC,OAAOhD,KAAKuC,eAAiBpC,YAAayB,yCAGnDA,UACJ5B,KAAKa,QAAQwC,KAAKrD,KAAKuC,eAAiBpC,YAAayB,8CAG5CA,UACT5B,KAAKa,QAAQwC,KAAKrD,KAAKuC,cAAe,mBAAQF,aAAgBT,6EAxGzDJ,yCALOD,EAAYzB,EAAMwD,EAAWxD,EAAKyD"}
"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},r=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},o=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},l=function(i){return function(l){function c(e){t(this,c),Object.assign(e,e.$el.data());var n=s(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,e));return n.reflectOptions(e),n.initializeEvents(e),n.initialize(e),n.logging.constructGrouping&&n.log("groupEnd","construct"),n}return r(c,i),n(c,[{key:"initialize",value:function(e){}},{key:"terminate",value:function(){}}]),n(c,[{key:"destructor",value:function(){var e,t=this.constructor.logColor("destructing","red"),n=(e=t,Array.isArray(e)?e:Array.from(e)),i=n[0],r=n.slice(1);this.log.apply(this,[this.constructor.groupingMethod(this.logging.constructGrouping),"construct"].concat(o(this.constructor.logBold(this.logging.constructPrefix+' "%REPLACE%" '+i,this.instanceName)),o(r),[this])),this.terminate(),this.listenedEvents&&(this.forgetEvents(this.listenedEvents),this.listenedEvents=null),this.logging.constructGrouping&&this.log("groupEnd","construct")}},{key:"reflectOptions",value:function(e){var t=this;this.constructor.reflectOptions&&Object.keys(e).forEach(function(n){t.constructor.reflectOptions.includes(n)&&(t[n]=e[n])})}},{key:"initializeEvents",value:function(e){var t=this.constructor.events;t&&(this.linkedEvents||(this.linkedEvents=this.linkEvents(this.helpers.isFunction(t)?t():t)),this.listenedEvents=this.listenEvents(this.linkedEvents))}},{key:"linkEvents",value:function(t){var n=this;return this.helpers.mapValues(t,function(t){return n.helpers.isString(t)?n[t].bind(n):e(n.helpers.isPlainObject(t))?n.linkEvents(t):t})}}]),c}()},c=function(e,o){var l,c;return c=l=function(l){function c(e){t(this,c);var n=s(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,e));return Object.defineProperty(n,"View",{enumerable:!0,writable:!0,value:o}),Object.defineProperty(n,"viewClasses",{enumerable:!0,writable:!0,value:{}}),Object.defineProperty(n,"viewInstances",{enumerable:!0,writable:!0,value:[]}),n.viewOptions=i({debugMode:n.debugMode},e.viewOptions),n.viewOptions.logging=i({},n.logging,{constructGrouping:"groupCollapsed",constructPrefix:"🏭",eventsDebounced:!1},e.viewOptions&&e.viewOptions.logging),n.log("info","construct",'🏭 "'+n.instanceName+'" views mixin activated.'),n}return r(c,e),n(c,[{key:"registerView",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.viewClasses[e.selector]?this.error("🏭 View class for selector `"+e.selector+"` already registered",this.viewClasses[e.selector]):(this.viewClasses[e.selector]=e,this.listenToElement(e.selector,function(i){return t.bindView(i,e,n)},function(n){return t.unbindView(n,e)},{delay:e.delay,silent:!0}))}},{key:"bindView",value:function(e,t,n){if(!this.canBind(e,t))return null;t.instanceIndex?t.instanceIndex+=1:t.instanceIndex=1;var r=new t(i({},this.helpers.deepMerge(this.viewOptions,n),{instanceName:t.selector+"_"+t.instanceIndex,$el:e}));return this.viewInstances.push(r),r}},{key:"canBind",value:function(e,t){var n=this.getViewsOnElement(e,t)[0];return!n||(this.log("warn","🏭 Element already has bound view",e,t,n),!1)}},{key:"unbindView",value:function(e,t){var n=this.getViewsOnElement(e,t)[0];n&&(n.destructor(),this.viewInstances=this.helpers.without(this.viewInstances,n))}},{key:"getViewsOnElement",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n={el:e instanceof $?e[0]:e};return t&&(n.constructor=t),this.helpers.filter(this.viewInstances,n)}},{key:"getViewsInContainer",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.helpers.filter(this.viewInstances,function(n){return n.$el.closest(e).length>0&&(t||n.el!==e[0])})}},{key:"getAllViews",value:function(e){return this.helpers.filter(this.viewInstances,{constructor:e})}},{key:"getFirstView",value:function(e){return this.helpers.find(this.viewInstances,{constructor:e})}},{key:"getFirstChildView",value:function(e){return this.helpers.find(this.viewInstances,function(t){return t instanceof e})}}]),c}(),Object.defineProperty(l,"View",{enumerable:!0,writable:!0,value:o}),c};module.exports=function(e){return c(e,l(e.NormasCore))};
//# sourceMappingURL=views.js.map

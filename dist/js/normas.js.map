{"version":3,"file":"normas.js","sources":["../../src/js/lib/jqueryAdditions.js","../../src/js/lib/helpers.js","../../src/js/mixins/dom.js","../../src/js/mixins/base.js","../../src/js/mixins/logging.js","../../src/js/index.js","../../src/js/mixins/events.js","../../src/js/mixins/mutations.js","../../src/js/mixins/navigation.js","../../src/js/mixins/elements.js","../../src/js/mixins/content.js"],"sourcesContent":["$.fn.each$ = function (handle) {\n  return this.each((index, element) => {\n    handle($(element), index);\n  });\n};\n\n$.fn.filter$ = function (handle) {\n  return this.filter((index, element) => handle($(element), index));\n};\n\n$.fn.map$ = function (handle) {\n  return this.map((index, element) => handle($(element), index));\n};\n\n// [showOrHide[, duration[, callback]]]\n$.fn.slideToggleByState = function slideToggleByState(...a) {\n  if (this.length > 0) {\n    if (a.length > 0) {\n      if (a.shift()) {\n        this.slideDown(...a);\n      } else {\n        this.slideUp(...a);\n      }\n    } else {\n      this.slideToggle();\n    }\n  }\n  return this;\n};\n\n// http://css-tricks.com/snippets/jquery/mover-cursor-to-end-of-textarea/\n$.fn.focusToEnd = function focusToEnd() {\n  let $this = this.first();\n  if ($this.is('select, :checkbox, :radio')) {\n    $this.focus();\n  } else {\n    let val = $this.val();\n    $this.focus().val('').val(val);\n  }\n  return this;\n};\n\n$.fn.focusTo = function focusTo(caretPos) {\n  return this.each((index, element) => {\n    if (element.createTextRange) {\n      let range = element.createTextRange();\n      range.move('character', caretPos);\n      range.select();\n    } else if (element.selectionStart) {\n      element.focus();\n      element.setSelectionRange(caretPos, caretPos);\n    } else {\n      element.focus();\n    }\n  });\n};\n\n/*\n ** Returns the caret (cursor) position of the specified text field.\n ** Return value range is 0-oField.value.length.\n */\n$.fn.caretPosition = function caretPosition() {\n  // Initialize\n  let iCaretPos = 0;\n  let oField = this[0];\n\n  // IE Support\n  if (document.selection) {\n    // Set focus on the element\n    oField.focus();\n    // To get cursor position, get empty selection range\n    let oSel = document.selection.createRange();\n    // Move selection start to 0 position\n    oSel.moveStart('character', -oField.value.length);\n    // The caret position is selection length\n    iCaretPos = oSel.text.length;\n  } else if (oField.selectionStart != null) {\n    iCaretPos = oField.selectionStart;\n  }\n\n  // Return results\n  return iCaretPos;\n};\n","// Sufficient for Normas implementation of functions like from lodash\n\nexport function isPlainObject(value) {\n  if (value == null || typeof value !== 'object') {\n    return false;\n  }\n  const proto = Object.getPrototypeOf(value);\n  if (proto === null) {\n    return true;\n  }\n  const constructor = Object.prototype.hasOwnProperty.call(proto, 'constructor') && proto.constructor;\n  return typeof constructor === 'function' && constructor instanceof constructor;\n}\n\nexport const isArray = Array.isArray;\n\nexport function isFunction(v) {\n  return typeof v === 'function';\n}\n\nexport function isString(v) {\n  return typeof v === 'string';\n}\n\nexport function compact(array) {\n  return filter(array, v => v);\n}\n\nexport function debounce(func, wait) {\n  let timeoutId;\n  return (...args) => {\n    if (timeoutId) {\n      clearTimeout(timeoutId);\n    }\n    timeoutId = setTimeout(() => {\n      func(...args);\n    }, wait);\n  }\n}\n\nexport function groupBy(array, key) {\n  return reduceBy(array, key, (grouped, groupKey, item) => {\n    if (grouped[groupKey]) {\n      grouped[groupKey].push(item);\n    } else {\n      grouped[groupKey] = [item];\n    }\n  });\n}\n\nexport function countBy(array, key) {\n  return reduceBy(array, key, (grouped, groupKey) => {\n    if (grouped[groupKey]) {\n      grouped[groupKey]++;\n    } else {\n      grouped[groupKey] = 1;\n    }\n  });\n}\n\nexport function groupByInArray(array, key) {\n  return reduceBy(array, key, (grouped, groupKey, item) => {\n    const group = find(grouped, ([k]) => k === groupKey);\n    if (group) {\n      group[1].push(item);\n    } else {\n      grouped.push([groupKey, [item]]);\n    }\n  }, []);\n}\n\nexport function flatten(array, deep = false) {\n  return array.reduce((flat, value) => {\n    if (isArray(value)) {\n      flat.push(...(deep ? flatten(value, true) : value));\n    } else {\n      flat.push(value);\n    }\n    return flat;\n  }, []);\n}\n\nexport function intersection(a, b) {\n  if (!isArray(b)) {\n    b = [b];\n  }\n  return (isArray(a) ? a : [a]).reduce((result, value) => {\n    if (includes(b, value)) {\n      result.push(value);\n    }\n    return result;\n  }, []);\n}\n\nexport function deepMerge(destination, source) {\n  return Object.keys(source).reduce((result, key) => {\n    if (source[key]) {\n      if (isPlainObject(destination[key]) && isPlainObject(source[key])) {\n        result[key] = deepMerge(destination[key], source[key]);\n      } else {\n        result[key] = source[key];\n      }\n      return result;\n    }\n  }, Object.assign({}, destination));\n}\n\nexport function filter(collection, conditions) {\n  return filterBase('filter', collection, conditions);\n}\n\nexport function find(collection, conditions) {\n  return filterBase('find', collection, conditions);\n}\n\nexport function findIndex(collection, conditions) {\n  return filterBase('find', collection, conditions);\n}\n\nexport function map(collection, iteratee) {\n  return Array.prototype.map.call(collection, iteratee);\n}\n\nexport function each(collection, iteratee) {\n  return Array.prototype.forEach.call(collection, iteratee);\n}\n\nexport function mapValues(object, iteratee) {\n  return Object.keys(object).reduce((result, key) => {\n    result[key] = iteratee(object[key], key);\n    return result;\n  }, {});\n}\n\nexport function without(collection, ...values) {\n  return difference(collection, values);\n}\n\nexport function difference(arrayA, arrayB) {\n  return filter(arrayA, a => !includes(arrayB, a));\n}\n\nexport function includes(collection, searchElement) {\n  return Array.prototype.indexOf.call(collection, searchElement) !== -1;\n}\n\n// private\n\nfunction reduceBy(array, key, reducer, initial = {}) {\n  return Array.prototype.reduce.call(array, (grouped, item) => {\n    const groupKey = isFunction(key) ? key(item) : item[key];\n    reducer(grouped, groupKey, item);\n    return grouped;\n  }, initial);\n}\n\nfunction filterBase(baseName, collection, conditions) {\n  return Array.prototype[baseName].call(collection, makeConditionsMatch(conditions));\n}\n\nfunction makeConditionsMatch(conditions) {\n  if (isFunction(conditions)) {\n    return conditions;\n  } else {\n    const conditionsKeys = Object.keys(conditions);\n    return item => filterMatch(item, conditions, conditionsKeys);\n  }\n}\n\nfunction filterMatch(item, conditions, conditionsKeys) {\n  return conditionsKeys.find(key => conditions[key] !== item[key]) === undefined;\n}\n","import { isArray, isPlainObject, mapValues, each } from '../lib/helpers';\n\nexport default {\n  memoryData(element, key, ...value) {\n    if (value.length > 0) {\n      this.elementsApply(element, el => { el[key] = value[0]; });\n    } else {\n      return element[key];\n    }\n  },\n\n  removeMemoryData(element, key) {\n    const value = element[key];\n    delete element[key];\n    return value;\n  },\n\n  data(element, key, ...value) {\n    if (value.length > 0) {\n      const stringifiedValue = this.dataStringify(value[0]);\n      this.elementsApply(element, el => { el.dataset[key] = stringifiedValue; });\n    } else {\n      return key\n        ?\n        this.dataParse(element.dataset[key])\n        :\n        mapValues(element.dataset, dataValue => this.dataParse(dataValue));\n    }\n  },\n\n  removeData(element, key) {\n    const value = element.dataset[key];\n    delete element.dataset[key];\n    return value;\n  },\n\n  dataStringify(data) {\n    return isArray(data) || isPlainObject(data)\n      ?\n      JSON.stringify(data)\n      :\n      data;\n  },\n\n  dataParse(dataValue) {\n    try {\n      return JSON.parse(dataValue);\n    } catch (e) {\n      this.lastDataParseError = e;\n      return dataValue;\n    }\n  },\n\n  elementsApply(element, iteratee) {\n    if (this.isElement(element)) {\n      iteratee(element);\n    } else {\n      each(element, iteratee);\n    }\n  },\n\n  isElement(element) {\n    return element instanceof Element;\n  },\n\n  contains(rootElement, element) {\n    return (rootElement === document ? document.body : rootElement).contains(element);\n  },\n\n  remove(element) {\n    element.parentNode.removeChild(element);\n  },\n};\n","import * as importedHelpers from '../lib/helpers';\nimport dom from './dom';\n\nconst mutableHelpers = Object.assign({}, importedHelpers);\n\nexport default class Base {\n  static version = '0.4.0-rc2';\n  static helpers = mutableHelpers;\n  static dom = dom;\n  helpers = mutableHelpers;\n  dom = dom;\n\n  constructor({ el = document, instanceName = 'NormasApp' }) {\n    this.instanceName = instanceName;\n    this.el = el;\n    this.$el = $(el);\n  }\n\n  $(...args) {\n    return this.$el.find(...args);\n  }\n\n  log(...args) {\n    // nop\n  }\n\n  error(...args) {\n    // nop\n  }\n\n  // protected\n\n  static readOptions(dest, source, defaults) {\n    Object.keys(defaults).forEach(key => {\n      dest[key] = source && (key in source) ? source[key] : defaults[key];\n    });\n  }\n}\n","export default Base => (class extends Base {\n  constructor(options) {\n    super(options);\n    this.constructor.readOptions(this, options, { debugMode: true });\n    this.logging = {};\n    this.constructor.readOptions(this.logging, options.logging, {\n      construct: true,\n      constructGrouping: true,\n      constructPrefix: 'ðŸ—ï¸',\n      hideInstancesOf: [],\n    });\n    const [constructText, ...constructStyles] = this.constructor.logColor('construct', 'green');\n    this.log(this.constructor.groupingMethod(this.logging.constructGrouping), 'construct',\n      ...this.constructor.logBold(`${this.logging.constructPrefix} \"%REPLACE%\" ${constructText}`, this.instanceName),\n      ...constructStyles,\n      this);\n  }\n\n  static consoleMethods = ['log', 'group', 'groupEnd', 'groupCollapsed', 'info', 'table', 'warn'];\n\n  log(...args) {\n    if (!this.debugMode) return;\n    const method = this.helpers.includes(this.constructor.consoleMethods, args[0]) ? args.shift() : 'log';\n    if (this.helpers.intersection(Object.keys(this.logging), args[0]).length > 0 && !this.logging[args.shift()]) {\n      return;\n    }\n    this.constructor.log(method, ...this.filterLog(args));\n  }\n\n  error(...args) {\n    this.constructor.log('error', ...args);\n  }\n\n  // private\n\n  filterLog(args) {\n    return this.logging.hideInstancesOf.length === 0 ? args :\n      this.helpers.filter(args, a => !this.helpers.find(this.logging.hideInstancesOf, c => a instanceof c));\n  }\n\n  static groupingMethod(grouping) {\n    return (typeof grouping === 'string') ? grouping : (grouping ? 'group' : 'log');\n  }\n\n  static log(method, ...args) {\n    if (console && console[method]) {\n      console[method](...args); // eslint-disable-line no-console\n    }\n  }\n\n  static logPlur(message, count, omitOne = true) {\n    return message.replace('%COUNT%', omitOne && count === 1 ? '' : count).replace('%S%', count === 1 ? '' : 's');\n  }\n\n  static logCycle(moveName, enter, intensity = 2) {\n    return this.logColor(\n      `${moveName} ${(enter ? '>' : '<').repeat(intensity)}`,\n      enter ? 'green' : 'red',\n    );\n  }\n\n  static logColor(template, colorText, color) {\n    if (!color) {\n      color = colorText;\n      colorText = null;\n    }\n    return this.logStyle(template, colorText, { color });\n  }\n\n  static logBold(template, boldText) {\n    return this.logStyle(template, boldText, { 'font-weight': 'bold' });\n  }\n\n  static logStyle(template, stylingReplace, style) {\n    if (this.helpers.isPlainObject(stylingReplace)) {\n      style = stylingReplace;\n      stylingReplace = null;\n    }\n    if (!stylingReplace) {\n      stylingReplace = template;\n      template = null;\n    }\n    const stylePairs = Object.entries(style);\n    const beginStyle = stylePairs.map(p => p.join(': ')).join('; ');\n    const endStyle = stylePairs.map(([k]) => [k, 'inherit'].join(': ')).join('; ');\n    stylingReplace = `%c${stylingReplace}%c`;\n    if (template) {\n      stylingReplace = template.replace('%REPLACE%', stylingReplace);\n    }\n    return [stylingReplace, beginStyle, endStyle];\n  }\n\n  static contentName($content) {\n    const contentCounts = this.helpers.countBy($content, content => {\n      const classList = content.classList ? this.helpers.map(content.classList, className => className) : [];\n      return [content.tagName].concat(classList).join('.');\n    });\n    return Object.keys(contentCounts).map(name => {\n      const count = contentCounts[name];\n      return `${count > 1 ? count + ' ' : ''}${name}`;\n    }).join(' + ');\n  }\n\n  static readmeLink(point) {\n    return `Read https://github.com/evrone/normas#${point}`;\n  }\n});\n","/**\n * Normas\n *\n * @see {@link https://github.com/evrone/normas|Github}\n * @license MIT\n * @copyright Dmitry Karpunin <koderfunk@gmail.com>, 2017-2018\n */\n\nimport './lib/jqueryAdditions';\nimport NormasBase from './mixins/base';\nimport NormasLogging from './mixins/logging';\nimport normasEvents from './mixins/events';\nimport normasContent from './mixins/content';\nimport normasElements from './mixins/elements';\nimport normasNavigation from './mixins/navigation';\nimport normasMutations from './mixins/mutations';\n\nconst NormasSubBase = NORMAS_DEBUG ? NormasLogging(NormasBase) : NormasBase;\n\nconst NormasCore = normasEvents(NormasSubBase);\n\nconst Normas =\n  normasMutations(\n    normasNavigation(\n      normasElements(\n        normasContent(\n          NormasCore\n        )\n      )\n    )\n  );\n\nNormas.NormasCore = NormasCore;\n\nexport default Normas;\n","export default Base => (class extends Base {\n  constructor(options) {\n    super(options);\n    if (NORMAS_DEBUG) {\n      this.constructor.readOptions(this.logging, options.logging, {\n        events: true,\n        eventsDebounced: true,\n        eventsTable: false,\n      });\n      if (this.debugMode && this.logging.events && this.logging.eventsDebounced) {\n        this.eventsLogBuffer = [];\n        this.logEventsDebounced = this.helpers.debounce(this.logEventsDebounced.bind(this), 20);\n      }\n      this.log('info', ['construct', 'events'],\n        `ðŸš¦ \"${this.instanceName}\" events mixin activated.`,\n        'logging.events =', this.logging.events,\n        'logging.eventsDebounced =', this.logging.eventsDebounced,\n        'logging.eventsTable =', this.logging.eventsTable);\n    }\n  }\n\n  trigger(eventName, ...args) {\n    this.$el.trigger(eventName, args);\n  }\n\n  listenEvents(...args) {\n    return this.listenEventsOnElement(this.$el, ...args);\n  }\n\n  listenEventsOnElement($element, ...args) {\n    const listeningArgs = this.constructor.listeningArguments(...args);\n    if (NORMAS_DEBUG && this.debugMode && this.logging.events) {\n      this.logEvents($element, listeningArgs);\n    }\n    listeningArgs.forEach(({ events, selector, handle }) => {\n      $element.on(events, selector, handle);\n    });\n    return listeningArgs;\n  }\n  \n  forgetEvents(listeningArgs) {\n    this.forgetEventsOnElement(this.$el, listeningArgs);\n  }\n\n  forgetEventsOnElement($element, listeningArgs) {\n    if (NORMAS_DEBUG) {\n      this.logEventsOutput($element, listeningArgs, false);\n    }\n    listeningArgs.forEach(({ events, selector, handle }) => {\n      $element.off(events, selector, handle);\n    });\n  }\n\n  // private\n\n  logEvents($element, listeningArgs) {\n    if (!NORMAS_DEBUG) {\n      return;\n    }\n    if (this.logging.eventsDebounced) {\n      const element = $element[0];\n      listeningArgs.forEach(args => { args.element = element; });\n      this.eventsLogBuffer = this.eventsLogBuffer.concat(listeningArgs);\n      this.logEventsDebounced();\n    } else {\n      this.logEventsOutput($element, listeningArgs, true);\n    }\n  }\n\n  logEventsDebounced() {\n    if (!NORMAS_DEBUG) {\n      return;\n    }\n    const grouped = this.helpers.groupByInArray(this.eventsLogBuffer, 'element');\n    grouped.forEach(([element, listeningArgs]) => {\n      this.logEventsOutput($(element), listeningArgs, true);\n    });\n    this.eventsLogBuffer = [];\n  }\n\n  logEventsOutput($element, listeningArgs, enter) {\n    if (!NORMAS_DEBUG || !this.logging.events) {\n      return;\n    };\n    const elementName = $element[0] === this.el ? this.instanceName : this.constructor.contentName($element);\n    const count = listeningArgs.length;\n    const plurEvents = this.constructor.logPlur('event%S%', count);\n    const [styledCount, ...countStyles] = count > 1 ? this.constructor.logBold(count) : [];\n    const [cycleName, ...cycleStyles] = this.constructor.logCycle(enter ? 'listen on' : 'forget from', enter);\n    const [styledElementName, ...elementStyles] = this.constructor.logBold(elementName);\n    this.log('events',\n      `ðŸš¦ ${styledCount ? styledCount + ' ' : ''}${plurEvents} ${cycleName} \"${styledElementName}\"`,\n      ...countStyles, ...cycleStyles, ...elementStyles,\n      $element, ...(this.logging.eventsTable ? [] : [listeningArgs]));\n    if (!this.logging.eventsTable) return;\n    this.log('table', listeningArgs.map(({ selector, events }) => ({ selector, events })));\n  }\n\n  static listeningArguments(selector, eventRule, handle) {\n    if (this.helpers.isPlainObject(selector)) {\n      eventRule = selector;\n      selector = '';\n    }\n\n    if (this.helpers.isFunction(eventRule)) {\n      handle = eventRule;\n      eventRule = selector;\n      selector = '';\n    }\n\n    if (this.helpers.isPlainObject(eventRule)) {\n      return this.helpers.flatten(Object.keys(eventRule).map((key) => {\n        let value = eventRule[key];\n        return this.helpers.isPlainObject(value) ?\n          this.listeningArguments(selector ? `${selector} ${key}` : key, value)\n          :\n          this.listeningArguments(selector, key, value);\n      }));\n    }\n\n    if (!this.helpers.isFunction(handle)) {\n      if (NORMAS_DEBUG) {\n        console.error(`handle isn't function in listening declaration! (selector: '${selector}')`); // eslint-disable-line no-console\n      }\n      return [];\n    }\n    if (!eventRule) {\n      if (NORMAS_DEBUG) {\n        console.error(`eventRule not defined! (selector: '${selector}')`); // eslint-disable-line no-console\n      }\n      return [];\n    }\n\n    const selectors = eventRule.split(/\\s+/);\n    const eventName = selectors[0];\n    selectors[0] = selector;\n\n    if (!eventName) {\n      if (NORMAS_DEBUG) {\n        console.error(`bad eventName in listening declaration! (selector: '${selector}')`); // eslint-disable-line no-console\n      }\n      return [];\n    }\n\n    return [{\n      events: eventName.replace(/\\//g, ' '),\n      selector: selectors.join(' ').trim(),\n      handle: (event, ...args) => handle($(event.currentTarget), event, ...args),\n    }];\n  }\n});\n","// require navigation mixin\nexport default Base => (class extends Base {\n  constructor(options) {\n    super(options);\n    if (!this.enablings) this.enablings = {};\n    this.constructor.readOptions(this.enablings, options.enablings, { mutations: true });\n    if (NORMAS_DEBUG) {\n      this.log('info', 'construct',\n          ...this.constructor.logColor(`ðŸ¤– \"${this.instanceName}\" MutationObserver %REPLACE%.`,\n            this.enablings.mutations ? 'enabled' : 'disabled',\n            this.enablings.mutations ? 'green' : 'blue'));\n    }\n    if (this.enablings.mutations) {\n      if (MutationObserver) {\n        this.observeMutations();\n      } else if (NORMAS_DEBUG) {\n        this.log('warn', 'construct', `ðŸ¤– \"${this.instanceName}\" mutation observer NOT SUPPORTED!`,\n          this.constructor.readmeLink('-content-broadcasting'));\n      }\n    }\n  }\n\n  observeMutations() {\n    // https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver\n    this.mutationObserver = new MutationObserver(mutations => mutations.forEach(this.checkMutations));\n    this.mutationObserver.observe(this.$el[0], { childList: true, subtree: true });\n  }\n\n  checkMutations = (mutation) => {\n    if (!this.navigationStarted || mutation.type !== 'childList') {\n      return;\n    }\n    const removedNodes = this.constructor.filterMutationNodes(mutation.removedNodes);\n    const addedNodes = this.constructor.filterMutationNodes(mutation.addedNodes, true);\n\n    if (removedNodes.length > 0) {\n      this.sayAboutContentLeave($(removedNodes));\n    }\n    if (addedNodes.length > 0) {\n      this.sayAboutContentEnter($(addedNodes));\n    }\n  };\n\n  static filterMutationNodes(nodes, checkParentElement = false) {\n    return Array.prototype.filter.call(nodes, node => (\n      node.nodeType === 1 &&\n        !node.isPreview &&\n        !['TITLE', 'META'].includes(node.tagName) &&\n        node.className !== 'turbolinks-progress-bar' &&\n        !(checkParentElement && !node.parentElement) &&\n        !(node.parentElement && node.parentElement.tagName === 'HEAD')\n    ));\n  }\n});\n","// require content mixin\nexport default Base => (class extends Base {\n  static pageEnterEventName = 'page:enter';\n  static pageLeaveEventName = 'page:leave';\n  static navigationStartedEventName = 'navigation:started';\n  static pageSelector = 'body';\n  navigationStarted = false;\n\n  constructor(options) {\n    super(options);\n    if (NORMAS_DEBUG) {\n      this.constructor.readOptions(this.logging, options.logging, {\n        navigation: true,\n        navigationGrouping: true,\n      });\n    }\n    this.bindPageEvents(options);\n    if (NORMAS_DEBUG) {\n      this.log('info', 'construct',\n        `ðŸ—º \"${this.instanceName}\" navigation mixin activated. logging.navigation =`, this.logging.navigation);\n    }\n  }\n\n  onStart(callback) {\n    this.$el.one(this.constructor.navigationStartedEventName, (event, $page) => callback($page));\n  }\n\n  bindPageEvents(options) {\n    if (NORMAS_DEBUG && (options.Turbolinks || global.Turbolinks)) {\n      this.log('warn',\n        'ðŸ—º You have Turbolinks, but not use integration.',\n        this.constructor.readmeLink('turbolinks-integration'));\n    }\n    $(this.pageEnter.bind(this));\n  }\n\n  listenToPage(enter, leave = null) {\n    if (enter) {\n      this.$el.on(this.constructor.pageEnterEventName, (event, $page) => enter($page));\n    }\n    if (leave) {\n      this.$el.on(this.constructor.pageLeaveEventName, (event, $page) => leave($page));\n    }\n  }\n\n  visit(location) {\n    window.location = location;\n  }\n\n  refreshPage() {\n    this.visit(window.location);\n  }\n\n  setHash(hash) {\n    location.hash = hash;\n  }\n\n  back() {\n    global.history.back();\n  }\n\n  replaceLocation(url) {\n    if (NORMAS_DEBUG) {\n      this.log('warn', 'ðŸ—º `replaceLocation` works only with Turbolinks.');\n    }\n  }\n\n  pushLocation(url, title = null, state = null) {\n    if (global.history) global.history.pushState(state, title, url);\n  }\n\n  sayAboutPageLoading(state) {\n    if (NORMAS_DEBUG) {\n      this.log('warn', 'ðŸ—º `sayAboutPageLoading` works only with Turbolinks.');\n    }\n  }\n\n  pageEnter() {\n    if (!this.navigationStarted) {\n      this.navigationStarted = true;\n      this.trigger(this.constructor.navigationStartedEventName, $page);\n      if (NORMAS_DEBUG && this.logging.constructGrouping) {\n        this.log('groupEnd', 'construct');\n      }\n    }\n    const $page = this.$page();\n    if (NORMAS_DEBUG) {\n      this.logPage('enter', $page);\n    }\n    this.trigger(this.constructor.pageEnterEventName, $page);\n    this.sayAboutContentEnter($page);\n  }\n\n  pageLeave() {\n    const $page = this.$page();\n    if (NORMAS_DEBUG) {\n      this.logPage('leave', $page);\n    }\n    this.sayAboutContentLeave($page);\n    this.trigger(this.constructor.pageLeaveEventName, $page);\n  }\n\n  $page() {\n    return this.$(this.constructor.pageSelector);\n  }\n\n  // private\n\n  logPage(logEvent, $page) {\n    if (!NORMAS_DEBUG || !this.debugMode || !this.logging.navigation) {\n      return;\n    }\n    const enter = logEvent === 'enter';\n    const [eventName, ...eventStyles] = this.constructor.logCycle(logEvent, enter, 10);\n    if (this.logging.navigationGrouping) {\n      this.logPageGroupEnd();\n    }\n    this.log(this.constructor.groupingMethod(this.logging.navigationGrouping), 'navigation',\n      `ðŸ—º page ${eventName}`,\n      ...eventStyles,\n      ...(enter ? [window.location.href] : []),\n      $page);\n    this.navigationGroup = true;\n    if (enter && this.logging.navigationGrouping) {\n      setTimeout(() => this.logPageGroupEnd(), 25);\n    }\n  }\n\n  logPageGroupEnd() {\n    if (NORMAS_DEBUG && this.navigationGroup) {\n      this.log('groupEnd', 'navigation');\n      this.navigationGroup = false;\n    }\n  }\n});\n","// require events mixin\n// require content mixin\nexport default Base => (class extends Base {\n  static preventContentEventsClassName = 'js-prevent-normas';\n  static elementEnterTimeoutIdDataName = 'elementEnterTimeoutId';\n\n  constructor(options) {\n    super(options);\n    if (NORMAS_DEBUG) {\n      this.constructor.readOptions(this.logging, options.logging, { elements: true });\n      this.log('info', 'construct',\n        `ðŸ’Ž \"${this.instanceName}\" elements mixin activated.`,\n        'logging.elements =', this.logging.elements);\n    }\n  }\n\n  listenToElement(selector, enter, leave = null, options = {}) {\n    options = Object.assign({ delay: 0, silent: false }, options);\n    this.listenToContent(\n      this.makeElementContentEnter(selector, enter, options),\n      this.makeElementContentLeave(selector, leave, options),\n    );\n  }\n\n  // private\n\n  makeElementContentEnter(selector, enter, { delay, silent }) {\n    return $content => {\n      let $elements = this.constructor.contentElements($content, selector);\n      if ($elements.length === 0) {\n        return;\n      }\n      if (delay > 0) {\n        this.dom.memoryData($elements, this.constructor.elementEnterTimeoutIdDataName, setTimeout(() => {\n          $content = $content.filter((index, element) => this.dom.contains(this.el, element));\n          if ($content.length === 0) {\n            return;\n          }\n          // check elements inclusion in $content after delay\n          $elements = this.constructor.contentElements($content, $elements);\n          if ($elements.length === 0) {\n            return;\n          }\n          // check elements with delay data\n          $elements = this.filterDelayedElements($elements, true);\n          if ($elements.length === 0) {\n            return;\n          }\n          this.handleElements($elements, selector, enter, 'enter', silent);\n        }, delay));\n      } else {\n        this.handleElements($elements, selector, enter, 'enter', silent);\n      }\n    };\n  }\n\n  makeElementContentLeave(selector, leave, { delay, silent }) {\n    if (!leave) {\n      return null;\n    }\n    return $content => {\n      let $elements = this.constructor.contentElements($content, selector);\n      if ($elements.length === 0) {\n        return;\n      }\n      if (delay > 0) {\n        $elements = this.filterDelayedElements($elements, false);\n        if ($elements.length === 0) {\n          return;\n        }\n      }\n      this.handleElements($elements, selector, leave, 'leave', silent);\n    };\n  }\n\n  filterDelayedElements($elements, delayState) {\n    return $elements.filter((index, element) => {\n      const delayed = this.dom.memoryData(element, this.constructor.elementEnterTimeoutIdDataName);\n      if (delayed) {\n        this.dom.removeMemoryData(element, this.constructor.elementEnterTimeoutIdDataName);\n      }\n      return !!delayed === delayState;\n    });\n  }\n\n  handleElements($elements, selector, handle, handleName, silent) {\n    let preventedElements = [];\n    const handledElements = this.helpers.filter($elements, element => {\n      if (!this.canCycleElement(element, selector, handleName)) {\n        return false;\n      }\n      const prevent = this.constructor.preventEventForElement(element);\n      if (prevent) {\n        preventedElements.push(element);\n        return false;\n      }\n      handle($(element));\n      return true;\n    });\n    if (NORMAS_DEBUG && !silent) {\n      this.logElements(handledElements, preventedElements, selector, handleName);\n    }\n  }\n\n  canCycleElement(element, selector, handleName) {\n    const normasElements = this.dom.memoryData(element, '_normasElements');\n    const selectorIndex = normasElements ? normasElements.indexOf(selector) : -1;\n    if (handleName === 'enter') {\n      if (selectorIndex !== -1) {\n        if (NORMAS_DEBUG) {\n          this.log('warn', 'elements',\n            ...this.constructor.logBold('ðŸ’Ž element \"%REPLACE%\" already entered.', selector),\n            element);\n        }\n        return false;\n      }\n      if (normasElements) {\n        normasElements.push(selector);\n      } else {\n        this.dom.memoryData(element, '_normasElements', [selector]);\n      }\n      return true;\n    }\n    // leave\n    if (selectorIndex !== -1) {\n      normasElements.splice(selectorIndex, 1);\n      return true;\n    }\n    if (NORMAS_DEBUG) {\n      this.log('warn', 'elements',\n        ...this.constructor.logBold('ðŸ’Ž element \"%REPLACE%\" try leave, but did not enter.', selector),\n        element);\n    }\n    return false;\n  }\n\n  logElements(handledElements, preventedElements, selector, handleName) {\n    if (!NORMAS_DEBUG) {\n      return;\n    }\n    const [elementName, ...elementStyles] = this.constructor.logBold(selector);\n    if (handledElements.length > 0) {\n      const [styledHandleName, ...handleStyles] = this.constructor.logCycle(handleName, handleName === 'enter', 3);\n      this._logElements(handledElements, '', styledHandleName, elementName, handleStyles, elementStyles);\n    }\n    if (preventedElements.length > 0) {\n      const [preventInfo, ...handleStyles] = this.constructor.logColor('prevent ', 'blue');\n      this._logElements(preventedElements, preventInfo, handleName, elementName, handleStyles, elementStyles);\n    }\n  }\n\n  _logElements(elements, preventInfo, handleName, elementName, handleStyles, elementStyles) {\n    if (!NORMAS_DEBUG) {\n      return;\n    }\n    const count = elements.length;\n    const plurElements = this.constructor.logPlur('element%S%', count);\n    const [styledCount, ...countStyles] = count > 1 ? this.constructor.logBold(count) : [];\n    const styles = [handleStyles];\n    styles[preventInfo ? 'push' : 'unshift'](countStyles);\n    this.log('elements',\n      `ðŸ’Ž ${preventInfo}${styledCount ? styledCount + ' ' : ''}${plurElements} ${handleName} \"${elementName}\"`,\n      ...this.helpers.flatten(styles), ...elementStyles,\n      elements);\n  }\n\n  static contentElements($content, selector) {\n    return $content.filter(selector).add($content.find(selector));\n  }\n\n  static preventEventForElement(element) {\n    return $(element).closest(`.${this.preventContentEventsClassName}`).length > 0;\n  }\n});\n","// require events mixin\nexport default Base => (class extends Base {\n  static contentEnterEventName = 'content:enter';\n  static contentLeaveEventName = 'content:leave';\n\n  constructor(options) {\n    super(options);\n    if (NORMAS_DEBUG) {\n      this.constructor.readOptions(this.logging, options.logging, {\n        content: false,\n        contentGrouping: true,\n      });\n      this.log('info', 'construct',\n        `ðŸ“° \"${this.instanceName}\" content mixin activated.`,\n        'logging.content =', this.logging.content);\n    }\n  }\n\n  // subscription to content lifecycle\n\n  listenToContent(enter, leave = null) {\n    if (enter) {\n      this.$el.on(this.constructor.contentEnterEventName, (event, $content) => enter($content, event));\n    }\n    if (leave) {\n      this.$el.on(this.constructor.contentLeaveEventName, (event, $content) => leave($content, event));\n    }\n  }\n\n  // manual content broadcasting\n\n  sayAboutContentEnter($content) {\n    return this.sayAboutContentMove('enter', this.constructor.contentEnterEventName, $content);\n  }\n\n  sayAboutContentLeave($content) {\n    return this.sayAboutContentMove('leave', this.constructor.contentLeaveEventName, $content);\n  }\n\n  // private\n  sayAboutContentMove(move, eventName, $content) {\n    const enter = move === 'enter';\n    $content = this.constructor.filterContent($content, (enter ? 'normasEntered' : 'normasLeft'), enter);\n    if ($content.length > 0) {\n      if (NORMAS_DEBUG) {\n        this.logContent(move, $content);\n      }\n      this.trigger(eventName, $content);\n      if (NORMAS_DEBUG && this.logging.contentGrouping) {\n        this.log('groupEnd', 'content');\n      }\n    }\n    return $content;\n  }\n\n  // helpers\n\n  replaceContentInner($container, content) {\n    this.sayAboutContentLeave($container);\n    $container.html(content);\n    this.sayAboutContentEnter($container);\n  }\n\n  replaceContent($content, $newContent) {\n    if ($content.length > 1) {\n      $content = $content.first();\n    }\n    this.sayAboutContentLeave($content);\n    $content.replaceWith($newContent);\n    this.sayAboutContentEnter($newContent);\n  }\n\n  // private\n\n  logContent(logEvent, $content) {\n    if (!NORMAS_DEBUG) {\n      return;\n    }\n    const [eventName, ...eventStyles] = this.constructor.logCycle(logEvent, logEvent === 'enter', 5);\n    const [contentName, ...contentStyles] = this.constructor.logBold(this.constructor.contentName($content));\n    this.log(this.constructor.groupingMethod(this.logging.contentGrouping), 'content',\n      `ðŸ“° content ${eventName} \"${contentName}\"`,\n      ...eventStyles, ...contentStyles,\n      $content);\n  }\n\n  static filterContent($content, elementFlagName, checkParentElement = false) {\n    return $content.filter((_index, element) => {\n      if (element[elementFlagName] || (checkParentElement && !element.parentElement)) {\n        return false;\n      }\n      element[elementFlagName] = true;\n      return true;\n    });\n  }\n});\n"],"names":["$","fn","each$","handle","this","each","index","element","filter$","filter","map$","map","slideToggleByState","length","a","shift","slideDown","slideUp","slideToggle","focusToEnd","$this","first","is","focus","val","focusTo","caretPos","createTextRange","range","move","select","selectionStart","setSelectionRange","caretPosition","iCaretPos","oField","document","selection","oSel","createRange","moveStart","value","text","isPlainObject","proto","Object","getPrototypeOf","constructor","prototype","hasOwnProperty","call","isArray","Array","isFunction","v","collection","conditions","filterBase","find","iteratee","forEach","mapValues","object","keys","reduce","result","key","difference","arrayA","arrayB","includes","searchElement","indexOf","reduceBy","array","reducer","initial","grouped","item","groupKey","baseName","conditionsKeys","undefined","filterMatch","makeConditionsMatch","func","wait","timeoutId","args","setTimeout","push","group","flatten","deep","flat","b","deepMerge","destination","source","assign","values","elementsApply","dataParse","dataset","_this","dataValue","stringifiedValue","dataStringify","data","JSON","stringify","parse","e","lastDataParseError","isElement","Element","rootElement","body","contains","parentNode","removeChild","mutableHelpers","importedHelpers","Base","el","instanceName","dom","$el","dest","defaults","NormasCore","options","readOptions","logging","debugMode","events","eventsDebounced","eventsLogBuffer","logEventsDebounced","helpers","debounce","bind","log","eventsTable","eventName","trigger","listenEventsOnElement","$element","listeningArgs","listeningArguments","logEvents","selector","on","forgetEventsOnElement","logEventsOutput","off","concat","groupByInArray","enter","elementName","contentName","count","plurEvents","logPlur","logBold","styledCount","countStyles","logCycle","cycleName","cycleStyles","styledElementName","elementStyles","eventRule","_this3","error","selectors","split","replace","join","trim","event","currentTarget","normasEvents","logColor","constructText","constructStyles","groupingMethod","constructGrouping","constructPrefix","method","consoleMethods","intersection","filterLog","hideInstancesOf","_this2","c","grouping","console","message","omitOne","moveName","intensity","repeat","template","colorText","color","logStyle","boldText","font-weight","stylingReplace","style","stylePairs","entries","beginStyle","p","endStyle","$content","contentCounts","countBy","classList","content","className","tagName","name","point","NormasLogging","NormasBase","Normas","mutation","navigationStarted","type","removedNodes","filterMutationNodes","addedNodes","sayAboutContentLeave","sayAboutContentEnter","enablings","mutations","MutationObserver","observeMutations","readmeLink","mutationObserver","checkMutations","observe","childList","subtree","nodes","checkParentElement","node","nodeType","isPreview","parentElement","normasMutations","bindPageEvents","navigation","callback","one","navigationStartedEventName","$page","Turbolinks","global","pageEnter","leave","pageEnterEventName","pageLeaveEventName","location","visit","window","hash","history","back","url","title","state","pushState","logPage","pageSelector","logEvent","eventStyles","navigationGrouping","logPageGroupEnd","href","navigationGroup","normasNavigation","elements","delay","silent","listenToContent","makeElementContentEnter","makeElementContentLeave","$elements","contentElements","memoryData","elementEnterTimeoutIdDataName","filterDelayedElements","handleElements","delayState","delayed","_this4","removeMemoryData","handleName","preventedElements","handledElements","_this5","canCycleElement","preventEventForElement","logElements","normasElements","selectorIndex","splice","styledHandleName","handleStyles","_logElements","preventInfo","plurElements","styles","add","closest","preventContentEventsClassName","contentEnterEventName","contentLeaveEventName","sayAboutContentMove","filterContent","logContent","contentGrouping","$container","html","$newContent","replaceWith","contentStyles","elementFlagName","_index","normasContent"],"mappings":"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"}